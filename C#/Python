import json

# Definición de la clase Tarea
class Tarea:
    def __init__(self, descripcion, completada=False):
        self.descripcion = descripcion
        self.completada = completada

    def __str__(self):
        estado = "Completada" if self.completada else "Pendiente"
        return f"Tarea: {self.descripcion} ({estado})"

# Definición de la clase GestorTareas
class GestorTareas:
    def __init__(self, nombre_archivo):
        self.nombre_archivo = nombre_archivo
        self.tareas = self.cargar_tareas()

    def cargar_tareas(self):
        try:
            with open(self.nombre_archivo, 'r') as file:
                tareas = json.load(file)
        except (FileNotFoundError, json.decoder.JSONDecodeError):
            tareas = []
        return [Tarea(**t) for t in tareas]

    def guardar_tareas(self):
        tareas_serializadas = [t.__dict__ for t in self.tareas]
        with open(self.nombre_archivo, 'w') as file:
            json.dump(tareas_serializadas, file, indent=2)

    def agregar_tarea(self):
        descripcion = input("Ingrese la descripción de la tarea: ")
        nueva_tarea = Tarea(descripcion)
        self.tareas.append(nueva_tarea)
        self.guardar_tareas()
        print(f"Tarea '{descripcion}' agregada exitosamente.")

    def marcar_completada(self):
        self.listar_tareas()
        indice = int(input("Ingrese el número de la tarea que desea marcar como completada: ")) - 1

        if 0 <= indice < len(self.tareas):
            self.tareas[indice].completada = True
            self.guardar_tareas()
            print("Tarea marcada como completada.")
        else:
            print("Índice de tarea no válido.")

    def listar_tareas(self):
        if self.tareas:
            print("\nLista de Tareas:")
            for i, tarea in enumerate(self.tareas):
                print(f"{i + 1}. {tarea}")
        else:
            print("\nNo hay tareas registradas.")

# Ejemplo de uso
gestor = GestorTareas("tareas.json")

while True:
    print("\n--- Menú ---")
    print("1. Agregar Tarea")
    print("2. Listar Tareas")
    print("3. Marcar Tarea como Completada")
    print("4. Salir")

    opcion = input("Seleccione una opción (1-4): ")

    if opcion == "1":
        gestor.agregar_tarea()
    elif opcion == "2":
        gestor.listar_tareas()
    elif opcion == "3":
        gestor.marcar_completada()
    elif opcion == "4":
        print("¡Hasta luego!")
        break
    else:
        print("Opción no válida. Intente de nuevo.")
